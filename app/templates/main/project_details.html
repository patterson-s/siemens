{% extends "base.html" %}

{% block content %}
    <h1 class="my-4">{{ project.name }}</h1>
    
    <div class="row">
        <div class="col-md-8">  <!-- Left column for documents and assessments -->
            <div class="card mb-3">  <!-- Documents card -->
                <div class="card-body">
                    <h5 class="card-title">Documents</h5>
                    <h6 class="card-subtitle mb-2 text-muted">Uploaded Documents</h6>
                    <ul>
                        {% for document in project.documents %}
                            <li>
                                {{ document.filename }} 
                                ({{ document.document_type|replace('_', ' ')|title }})
                                <form action="{{ url_for('main.delete_document', project_id=project.id, document_id=document.id) }}" 
                                      method="POST" style="display:inline;">
                                    <button type="submit" class="btn btn-link text-danger" 
                                            onclick="return confirm('Are you sure you want to delete this document?');">X</button>
                                </form>
                            </li>
                        {% else %}
                            <li>No documents uploaded yet.</li>
                        {% endfor %}
                    </ul>
                    <a href="{{ url_for('main.upload_document', project_id=project.id) }}" class="btn btn-primary">Upload Document</a>
                </div>
            </div>

            <div class="card mb-3">  <!-- Assessments card -->
                <div class="card-body">
                    <h5 class="card-title">Assessments</h5>
                    <h6 class="card-subtitle mb-2 text-muted">Previous Assessment Runs</h6>
                    <ul>
                        {% for evaluation in project.evaluation_runs|sort(attribute='created_at', reverse=True) %}
                            <li>
                                {% set adjusted_time = evaluation.created_at.replace(
                                    hour=(evaluation.created_at.hour - 4) % 24,
                                    day=evaluation.created_at.day - 1 if evaluation.created_at.hour < 4 else evaluation.created_at.day
                                ) %}
                                {{ adjusted_time.strftime('%b %d, %Y %H:%M') }} EDT
                                using {{ evaluation.model_used|replace('claude-', 'Claude ')|replace('-latest', '')|replace('-', '.')|title }}
                                ({{ evaluation.responses|length }} questions)
                                <a href="{{ url_for('main.view_assessment', project_id=project.id, evaluation_id=evaluation.id) }}" 
                                   class="btn btn-sm btn-info">View Assessment</a>
                                <form action="{{ url_for('main.delete_assessment', project_id=project.id, evaluation_id=evaluation.id) }}" 
                                      method="POST" style="display:inline;">
                                    <button type="submit" class="btn btn-link text-danger" 
                                            onclick="return confirm('Are you sure you want to delete this assessment run?');">X</button>
                                </form>
                            </li>
                        {% else %}
                            <li>No assessments run yet.</li>
                        {% endfor %}
                    </ul>
                    <div class="btn-group">
                        <a href="{{ url_for('main.start_assessment', project_id=project.id) }}" 
                           class="btn btn-primary">Start New Assessment (Claude)</a>
                        
                    </div>
                </div>
            </div>

        </div>

        <div class="col-md-4">  <!-- Right column for project details -->
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Project Details</h5>
                    <table class="table table-sm">
                        <tbody>
                            <tr>
                                <th>Round</th>
                                <td>{{ project.name_of_round }}</td>
                            </tr>
                            <tr>
                                <th>File Number</th>
                                <td>{{ project.file_number_db }}</td>
                            </tr>
                            <tr>
                                <th>Scope</th>
                                <td>{{ project.scope }}</td>
                            </tr>
                            <tr>
                                <th>Region</th>
                                <td>{{ project.region }}</td>
                            </tr>
                            <tr>
                                <th>Countries</th>
                                <td>{{ project.countries_covered }}</td>
                            </tr>
                            <tr>
                                <th>Partner Name</th>
                                <td>{{ project.integrity_partner_name }}</td>
                            </tr>
                            <tr>
                                <th>Partner Type</th>
                                <td>{{ project.partner_type }}</td>
                            </tr>
                            <tr>
                                <th>Project Partners</th>
                                <td>{{ project.project_partners }}</td>
                            </tr>
                            <tr>
                                <th>WB/EIB</th>
                                <td>{{ project.wb_or_eib }}</td>
                            </tr>
                            <tr>
                                <th>Objectives</th>
                                <td>{{ project.key_project_objectives }}</td>
                            </tr>
                            <tr>
                                <th>Sectoral Scope</th>
                                <td>{{ project.sectoral_scope }}</td>
                            </tr>
                            <tr>
                                <th>Specific Sector</th>
                                <td>{{ project.specific_sector }}</td>
                            </tr>
                            <tr>
                                <th>Funding (USD)</th>
                                <td>{{ project.funding_amount_usd }}</td>
                            </tr>
                            <tr>
                                <th>Duration</th>
                                <td>{{ project.duration }}</td>
                            </tr>
                            <tr>
                                <th>Years</th>
                                <td>{{ project.start_year }} - {{ project.end_year }}</td>
                            </tr>
                            <tr>
                                <th>Documents Available</th>
                                <td>
                                    {% if project.final_external_evaluation %}Final Evaluation<br>{% endif %}
                                    {% if project.final_report %}Final Report<br>{% endif %}
                                    {% if project.full_proposal %}Full Proposal<br>{% endif %}
                                    {% if project.workplan %}Workplan<br>{% endif %}
                                    {% if project.baseline_assessment %}Baseline Assessment{% endif %}
                                </td>
                            </tr>
                            {% if project.other %}
                            <tr>
                                <th>Other</th>
                                <td>{{ project.other }}</td>
                            </tr>
                            {% endif %}
                            {% if project.notes %}
                            <tr>
                                <th>Notes</th>
                                <td>{{ project.notes }}</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endblock %} 