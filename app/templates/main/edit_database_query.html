{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header">
                    <h2>Edit Database Query</h2>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('main.edit_synthesis_question', id=question.id) }}">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                        <div class="mb-3">
                            <label for="title" class="form-label">Title</label>
                            <input type="text" class="form-control" id="title" name="title" value="{{ question.title }}" required>
                        </div>
                        <div class="mb-3">
                            <label for="prompt" class="form-label">Prompt</label>
                            <textarea class="form-control" id="prompt" name="prompt" rows="4" required>{{ question.prompt }}</textarea>
                        </div>
                        
                        <!-- Question Selection Section -->
                        <div class="mb-3">
                            <label class="form-label">Select Question Responses to Include</label>
                            <div class="border rounded p-3" style="max-height: 300px; overflow-y: auto;" id="questions-container">
                                {% for q in questions %}
                                <div class="form-check mb-2 question-item" data-id="{{ q.id }}">
                                    <input class="form-check-input question-checkbox" type="checkbox" 
                                           name="question_ids" value="{{ q.id }}" 
                                           id="question-{{ q.id }}"
                                           {% if q.id in question.question_ids %}checked{% endif %}>
                                    <label class="form-check-label" for="question-{{ q.id }}">
                                        {{ q.name }} - {{ q.question }}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('main.synthesis_questions') }}" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
.question-item {
    padding: 8px;
    border-radius: 4px;
    transition: background-color 0.2s ease;
    cursor: pointer;
}

.question-item:hover {
    background-color: #f8f9fa;
}

.question-item.checked {
    background-color: #e8f4f8;
}

.question-item.checked:hover {
    background-color: #d8e4e8;
}
</style>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('questions-container');
    const questionItems = document.querySelectorAll('.question-item');
    const checkboxes = document.querySelectorAll('.question-checkbox');

    // Initialize checked state
    questionItems.forEach(item => {
        const checkbox = item.querySelector('.question-checkbox');
        if (checkbox.checked) {
            item.classList.add('checked');
        }
    });

    // Add hover effect and click handling
    questionItems.forEach(item => {
        const checkbox = item.querySelector('.question-checkbox');
        
        // Handle checkbox change
        checkbox.addEventListener('change', function() {
            // Update the item's checked class
            item.classList.toggle('checked', this.checked);
            
            // Reorder items
            const checkedItems = Array.from(questionItems).filter(item => 
                item.querySelector('.question-checkbox').checked
            );
            const uncheckedItems = Array.from(questionItems).filter(item => 
                !item.querySelector('.question-checkbox').checked
            );
            
            // Clear container
            container.innerHTML = '';
            
            // Add checked items first, then unchecked items
            [...checkedItems, ...uncheckedItems].forEach(item => {
                container.appendChild(item);
            });
        });

        // Make the entire item clickable
        item.addEventListener('click', function(e) {
            if (e.target !== checkbox) {
                checkbox.checked = !checkbox.checked;
                checkbox.dispatchEvent(new Event('change'));
            }
        });
    });

    // Initial sort
    const checkedItems = Array.from(questionItems).filter(item => 
        item.querySelector('.question-checkbox').checked
    );
    const uncheckedItems = Array.from(questionItems).filter(item => 
        !item.querySelector('.question-checkbox').checked
    );
    
    container.innerHTML = '';
    [...checkedItems, ...uncheckedItems].forEach(item => {
        container.appendChild(item);
    });
});
</script>
{% endblock %} 